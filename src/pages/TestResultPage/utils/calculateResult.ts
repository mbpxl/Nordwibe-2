import type { SelectedAnswer, ScaleMap } from "../types/test";

export interface TestScores {
  extraversion: number;
  neatness: number;
  loyalty: number;
}

export interface TestResult {
  title: string;
  description: string;
  scores: TestScores;
}

export const calculateResult = (
  answers: SelectedAnswer[],
  scaleMap: ScaleMap
): TestResult => {
  const scores: TestScores = { extraversion: 0, neatness: 0, loyalty: 0 };

  for (const a of answers) {
    const scale = scaleMap[a.questionId];
    if (!scale) continue;
    if (scale === "EXTRAVERSION") scores.extraversion += a.value;
    if (scale === "NEATNESS") scores.neatness += a.value;
    if (scale === "LOYALTY") scores.loyalty += a.value;
  }

  const { extraversion, neatness, loyalty } = scores;

  let title = "";
  let description = "";

  if (extraversion >= 11) {
    title = "Тусовщик";
    description =
      "Ты — душа компании. Тебе важно, чтобы вокруг кипела жизнь, а дом был не просто местом отдыха, а пространством для встреч и общения. Ты легко заводишь новые знакомства и поддерживаешь атмосферу веселья. С тобой интересно тем, кто ценит активность и живое общение. Однако соседям, предпочитающим тишину, может быть сложнее, поэтому для гармоничного сосуществования стоит договариваться о личных границах и правилах совместного проживания.";
  } else if (neatness >= 11) {
    title = "Домашний хранитель";
    description =
      "Для тебя дом — это крепость и отражение твоего внутреннего мира. Ты ценишь порядок, уют и предсказуемость. У тебя всегда аккуратно разложены вещи, кухня в чистоте, а пространство организовано так, чтобы создавать комфорт. Жить с тобой легко тем, кто придерживается схожих привычек и ценит структурированность. Но соседям, которые более свободны в быту, важно учитывать твою потребность в порядке.";
  } else if (loyalty >= 11) {
    title = "Лояльный сосед";
    description =
      "Ты — комфортный и дружелюбный человек, который уважает привычки и особенности других людей. Ты гибкий, легко идёшь на компромиссы, стараешься избегать конфликтов и ценишь доброжелательную атмосферу. С тобой приятно и спокойно жить большинству соседей. Однако иногда окружающие могут воспринимать твою открытость и мягкость как готовность подстраиваться всегда, поэтому стоит помнить и о собственных границах.";
  } else if (
    extraversion >= 9 &&
    extraversion <= 11 &&
    neatness >= 9 &&
    neatness <= 11 &&
    loyalty >= 9 &&
    loyalty <= 11
  ) {
    title = "Балансированный";
    description =
      "Ты находишь золотую середину в разных сферах. Можешь наслаждаться шумной компанией и при этом ценишь уединение и спокойствие. Ты умеешь адаптироваться под ситуацию, легко находишь общий язык с разными людьми и создаёшь комфортные условия для общения. Благодаря этому твой образ жизни подходит большинству соседей, так как ты способен учитывать интересы разных сторон.";
  } else if (extraversion < 8 && neatness < 8 && loyalty < 8) {
    title = "Уникальный сосед";
    description =
      "У тебя собственный ритм и подход к жизни. Ты ценишь личное пространство и свободу, предпочитаешь самостоятельно выстраивать привычки и распорядок. Жить с тобой особенно удобно тем, кто разделяет схожее отношение к личной независимости. Если же у соседей привычки отличаются, то взаимное уважение и договорённости помогут создать гармонию.";
  } else {
    title = "Индивидуальный результат";
    description =
      "Твой образ жизни сочетает разные качества и не попадает в общепринятые категории. Это делает тебя особенным, со своим взглядом на порядок, общение и взаимодействие с окружающими. Такой результат подчёркивает уникальность твоего характера и подхода к жизни.";
  }

  return { title, description, scores };
};
